/*global module, process*/
var Buffer = require('safe-buffer').Buffer;
var Stream = require('stream');
var util = require('util');

function DataStream(data) ***REMOVED***
  this.buffer = null;
  this.writable = true;
  this.readable = true;

  // No input
  if (!data) ***REMOVED***
    this.buffer = Buffer.alloc(0);
    return this;
  ***REMOVED***

  // Stream
  if (typeof data.pipe === 'function') ***REMOVED***
    this.buffer = Buffer.alloc(0);
    data.pipe(this);
    return this;
  ***REMOVED***

  // Buffer or String
  // or Object (assumedly a passworded key)
  if (data.length || typeof data === 'object') ***REMOVED***
    this.buffer = data;
    this.writable = false;
    process.nextTick(function () ***REMOVED***
      this.emit('end', data);
      this.readable = false;
      this.emit('close');
    ***REMOVED***.bind(this));
    return this;
  ***REMOVED***

  throw new TypeError('Unexpected data type ('+ typeof data + ')');
***REMOVED***
util.inherits(DataStream, Stream);

DataStream.prototype.write = function write(data) ***REMOVED***
  this.buffer = Buffer.concat([this.buffer, Buffer.from(data)]);
  this.emit('data', data);
***REMOVED***;

DataStream.prototype.end = function end(data) ***REMOVED***
  if (data)
    this.write(data);
  this.emit('end', data);
  this.emit('close');
  this.writable = false;
  this.readable = false;
***REMOVED***;

module.exports = DataStream;
